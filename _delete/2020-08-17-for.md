---
layout: default
title:  "for文の雑感"

---

おー プログラミングの記事〜

for文、是非が分かれると思うんですよ。
Rubyにはfor文、あるにはあるんですけど、全く使われていないです。
eachメソッドがありますので。

じゃあfor文は無くても良いのか? みたいな事を考えていました。

(↑Rubyではfor文ではなくfor式ですが)
(eachと比べてスコープを作らない、という違いはありますが)

あと繰り返しのネスト減らす方法とかも考えていました。

## for文のメリットデメリット

Rubyのeachみたいに、高階関数で、関数引数をとって繰り返すメソッドがあればfor文は要らないのでしょうか?
(一応、ここでのfor文は拡張for文. `for a in arr`みたいな方です)

### メリット
for文があれば、その内側にかかれている処理は絶対に繰り返しのための処理と、構文からわかります。

Rubyだと、`arr.piyo{|a| ~ }`と書かれていると、ブロックの処理がeach的な処理なのかmap的な処理なのかが、構文上からは分かりません。
`each_cons`は繰り返しで使われそうですが`select`を繰り返し処理には使わないですよね? でも構文からはわかりません。

Pythonだと、`for a in arr.piyo():`って書いてあれば、その内側は絶対に繰り返し用の処理とわかります。
逆に、for文を使わず、関数を引数に受け取っていれば、その関数引数は繰り返し用 **ではない** ことがわかります

### デメリット
デメリットという言い方は不自然ですが、forキーワードをわざわざ消費していることにモヤモヤが残ります。

もうひとつ、関数を引数とする処理は別に「繰り返し(each)」と「変形(map)」だけではありません。
「フック」とかもあります。

`at_exit{~}`とか`before_update{~}`とか、〇〇したとき呼び出して欲しいみたいなときも関数を渡していますね。

「繰り返し」「変形」「フック」... のうち、「繰り返し」だけが特別にforキーワードをもらっていて不平等感がちょっとあります。

## 繰り返し処理のネストを減らそう

話は変わって、繰り返し処理のネストを減らすコツです。

内側と外側が独立しているなら、直積をとりましょう。
縦800横600の画像の走査みたいなのは, `[*1..600].product([*1..800])`で1ネストで書けます。

内側が外側の影響を受けているときは、遅延評価を使いましょう。
具体的には、月からその月の日数を取る、のようなときです。
普通に`map`で1重ループに直すと、実行順序が変わってしまいます。
2重ループは深さ優先的だったのが、1重ループ2回は幅優先的になってしまします。
そこで、遅延評価の`lazy.map`を使うことで、1重でも深さ優先探索的になってハッピーという話でした。

---

scrapboxに書いたのを文章に直したら変になってしまった。

その道のプロはループとか使わずに全部再帰で書いたりするんですかね。


